<div class="streamers-view">
    <div class="streamers-header">
        <h2>ğŸ‘¥ My Streamers</h2>
        <button class="btn btn-primary btn-lg" (click)="onAdd()">â• Add Streamer</button>
    </div>

    <!-- Filters -->
    <div *ngIf="streamers.length > 0" class="filters">
        <div class="filters-row">
            <div class="input-with-icon">
                <span class="icon">ğŸ”</span>
                <input
                    type="text"
                    class="input"
                    placeholder="Search by name or platform..."
                    [ngModel]="searchTerm"
                    (ngModelChange)="onSearchChange($event)"
                />
            </div>
            <div class="ranges">
                <div class="range">
                    <label for="minSubs">Min subs: <strong>{{ minSubs | number }}</strong></label>
                    <input id="minSubs" type="range" [min]="0" [max]="maxSubs" [step]="1" [ngModel]="minSubs" (ngModelChange)="onMinSubsChange($event)" />
                </div>
                <div class="range">
                    <label for="maxSubs">Max subs: <strong>{{ maxSubsFilter | number }}</strong></label>
                    <input id="maxSubs" type="range" [min]="minSubs" [max]="maxSubs" [step]="1" [ngModel]="maxSubsFilter" (ngModelChange)="onMaxSubsChange($event)" />
                </div>
            </div>
        </div>
        <div class="chips">
            <span
                class="chip"
                role="button"
                [attr.aria-pressed]="selectedPlatforms.size === 0"
                [class.active]="selectedPlatforms.size === 0"
                (click)="clearPlatforms()"
            >All</span>
            <span
                *ngFor="let p of platforms"
                class="chip"
                role="button"
                [attr.aria-pressed]="selectedPlatforms.has(p)"
                [class.active]="selectedPlatforms.has(p)"
                (click)="togglePlatform(p)"
            >{{ p }}</span>
        </div>
        <div class="sort-bar">
            <div class="sort-chips">
                <span class="label">Sort by:</span>
                <span class="chip" role="button" [attr.aria-pressed]="sortBy === 'lastUpdate'" [class.active]="sortBy === 'lastUpdate'" (click)="onSortByChange('lastUpdate')">Last Update</span>
                <span class="chip" role="button" [attr.aria-pressed]="sortBy === 'name'" [class.active]="sortBy === 'name'" (click)="onSortByChange('name')">Name</span>
                <span class="chip" role="button" [attr.aria-pressed]="sortBy === 'followers'" [class.active]="sortBy === 'followers'" (click)="onSortByChange('followers')">Followers</span>
                <span class="chip" role="button" [attr.aria-pressed]="sortBy === 'platform'" [class.active]="sortBy === 'platform'" (click)="onSortByChange('platform')">Platform</span>
            </div>
            <span class="chip dir" role="button" [attr.aria-label]="'Sort direction ' + sortDir" (click)="toggleSortDir()">Dir {{ sortDir === 'asc' ? 'â†‘' : 'â†“' }}</span>
        </div>
        <div class="results-info">Showing {{ filteredStreamers.length }} of {{ streamers.length }} â€¢ Range {{ minSubs | number }}â€“{{ maxSubsFilter | number }}</div>
    </div>

    <div *ngIf="filteredStreamers.length > 0" id="streamers-list" class="grid">
        <div *ngFor="let streamer of filteredStreamers" class="streamer-item">
            <div class="streamer-header">
                <h3 class="streamer-name">{{ streamer.name }}</h3>
                <span class="streamer-platform">{{ streamer.platform }}</span>
            </div>

            <div class="streamer-stats">
                <div class="stat-item">
                    <span class="stat-item-label">Current Subs</span>
                    <span class="stat-item-value">{{ getLatestCount(streamer) | number }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-item-label">Earnings</span>
                    <span class="stat-item-value">$ {{ getEarnings(streamer) | number }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-item-label">Tracked Subs</span>
                    <span class="stat-item-value">{{ differenceLatestHistory(streamer) | number }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-item-label">Earnings Tracked</span>
                    <span class="stat-item-value">$ {{ getEarningsTracked(streamer) | number }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-item-label">Growth</span>
                    <span class="stat-item-value" [class.positive]="getGrowth(streamer) > 0" [class.negative]="getGrowth(streamer) < 0">
                        {{ getGrowth(streamer) >= 0 ? '+' : '' }}{{ getGrowth(streamer) | number }}
                    </span>
                </div>
                <div class="stat-item">
                    <span class="stat-item-label">Growth Earnings</span>
                    <span class="stat-item-value">
                       $ {{ getGrowthEarnings(streamer) | number }}
                    </span>
                </div>
                <div class="stat-item">
                    <span class="stat-item-label">Updates</span>
                    <span class="stat-item-value">{{ getTotalUpdates(streamer) }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-item-label">Last Update</span>
                    <span class="stat-item-value" [class.today]="isToday(getLastUpdateTimestamp(streamer))" [title]="getLastUpdateTimestamp(streamer) | date:'medium'">
                        {{ getLastUpdateLabel(streamer) }}
                    </span>
                </div>
            </div>

            <div class="streamer-actions">
                <button class="btn btn-sm btn-info" (click)="onUpdate(streamer)" [disabled]="!canUpdate(streamer)">ğŸ“ˆ Update</button>
                <button class="btn btn-sm btn-secondary" (click)="onEdit(streamer)">âœï¸ Edit</button>
                <button class="btn btn-sm btn-danger" (click)="onDelete(streamer.id, streamer.name)">ğŸ—‘ï¸ Delete</button>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="streamers.length === 0 && !loading" class="empty-state">
        <div class="empty-icon">ğŸŒˆ</div>
        <h2 class="empty-title">No Streamers Yet!</h2>
        <p class="empty-text">Add your first streamer to start tracking!</p>
        <button class="btn btn-primary btn-lg" (click)="onAdd()">â• Add Your First Streamer</button>
    </div>

    <!-- No results state after filters -->
    <div *ngIf="streamers.length > 0 && filteredStreamers.length === 0 && !loading" class="empty-state">
        <div class="empty-icon">ğŸ”</div>
        <h2 class="empty-title">No matching streamers</h2>
        <p class="empty-text">Try adjusting your search or filters.</p>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
        <p>Loading streamers...</p>
    </div>
</div>